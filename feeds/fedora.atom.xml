<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Cole Robinson - fedora</title><link href="https://blog.wikichoon.com/" rel="alternate"></link><link href="https://blog.wikichoon.com/feeds/fedora.atom.xml" rel="self"></link><id>https://blog.wikichoon.com/</id><updated>2020-07-12T00:00:00-04:00</updated><subtitle>Cole's dev log</subtitle><entry><title>virt-manager libvirt XML editor UI</title><link href="https://blog.wikichoon.com/2020/07/virt-manager-xml-editor.html" rel="alternate"></link><published>2020-07-12T00:00:00-04:00</published><updated>2020-07-12T00:00:00-04:00</updated><author><name>Cole Robinson</name></author><id>tag:blog.wikichoon.com,2020-07-12:/2020/07/virt-manager-xml-editor.html</id><summary type="html">&lt;p&gt;&lt;a href="https://www.redhat.com/archives/virt-tools-list/2019-June/msg00099.html"&gt;virt-manager 2.2.0&lt;/a&gt; was released in June of last year. It shipped with a major new feature: libvirt XML viewing and editing UI for new and existing domain, pools, volumes, networks.&lt;/p&gt;
&lt;p&gt;Every VM, network, and storage object page has a &lt;strong&gt;XML&lt;/strong&gt; tab at the top. Here's an example with …&lt;/p&gt;</summary><content type="html">&lt;p&gt;&lt;a href="https://www.redhat.com/archives/virt-tools-list/2019-June/msg00099.html"&gt;virt-manager 2.2.0&lt;/a&gt; was released in June of last year. It shipped with a major new feature: libvirt XML viewing and editing UI for new and existing domain, pools, volumes, networks.&lt;/p&gt;
&lt;p&gt;Every VM, network, and storage object page has a &lt;strong&gt;XML&lt;/strong&gt; tab at the top. Here's an example with that tab selected from the VM &lt;strong&gt;Overview&lt;/strong&gt; section:&lt;/p&gt;
&lt;p&gt;&lt;img alt="VM XML editor" src="https://blog.wikichoon.com/images/079-xml1.png" width="500"&gt;&lt;/p&gt;
&lt;p&gt;Here's an example of the XML view when just a disk is selected. Note it only shows that single device's libvirt XML:&lt;/p&gt;
&lt;p&gt;&lt;img alt="Disk XML editor" src="https://blog.wikichoon.com/images/079-xml2.png" width="500"&gt;&lt;/p&gt;
&lt;p&gt;By default the XML is not editable; notice the warning at the top of the first image. After editing is enabled, the warning is gone, like in the second image. You can enable editing via Edit-&amp;gt;Preferences from the main &lt;strong&gt;Manager&lt;/strong&gt; window. Here's what the option looks like:&lt;/p&gt;
&lt;p&gt;&lt;img alt="XML edit preference" src="https://blog.wikichoon.com/images/079-xml-prefs.png" width="500"&gt;&lt;/p&gt;
&lt;p&gt;A bit of background: We are constantly receiving requests to expose libvirt XML config options in virt-manager's UI. Some of these knobs are necessary for &amp;lt;1% but uninteresting to the rest. Some options are difficult to set from the command line because they must be set at VM install time, which means switch from virt-manager to virt-install which is not trivial. And so on. When these options aren't added to the UI, it makes life difficult for those affected users. It's also difficult and draining to have these types of justification conversations on the regular.&lt;/p&gt;
&lt;p&gt;The XML editing UI was added to relieve some of the pressure on virt-manager developers fielding these requests, and to give more power to advanced virt users. The users that know they need an advanced option are usually comfortable editing the libvirt XML directly. The XML editor doesn't detract from the existing UI much IMO, and it is uneditable by default to prevent less knowledgeable users from getting into trouble. It ain't gonna win any words for great UI, but the feedback has been largely positive so far.&lt;/p&gt;</content><category term="fedora"></category><category term="virt"></category></entry><entry><title>virt-convert tool removed in virt-manager.git</title><link href="https://blog.wikichoon.com/2020/07/virt-convert-removed.html" rel="alternate"></link><published>2020-07-11T00:00:00-04:00</published><updated>2020-07-11T00:00:00-04:00</updated><author><name>Cole Robinson</name></author><id>tag:blog.wikichoon.com,2020-07-11:/2020/07/virt-convert-removed.html</id><summary type="html">&lt;p&gt;The next release of virt-manager will not ship the &lt;code&gt;virt-convert&lt;/code&gt; tool, I removed it upstream with &lt;a href="https://github.com/virt-manager/virt-manager/commit/ee9f93074bf74bd2e4c5177d750e7c438c7790cf"&gt;this commit&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Here's the slightly edited quote from my original proposal to remove it:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;virt-convert takes an ovf/ova or vmx file and spits out libvirt XML.
It started as a code drop a …&lt;/p&gt;&lt;/blockquote&gt;</summary><content type="html">&lt;p&gt;The next release of virt-manager will not ship the &lt;code&gt;virt-convert&lt;/code&gt; tool, I removed it upstream with &lt;a href="https://github.com/virt-manager/virt-manager/commit/ee9f93074bf74bd2e4c5177d750e7c438c7790cf"&gt;this commit&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Here's the slightly edited quote from my original proposal to remove it:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;virt-convert takes an ovf/ova or vmx file and spits out libvirt XML.
It started as a code drop a long time ago that could translate back and
forth between vmx, ovf, and virt-image, a &lt;a href="https://blog.wikichoon.com/2014/04/deprecating-little-used-tool-virt-image1.html"&gt;long dead appliance format&lt;/a&gt;.
In 2014 I &lt;a href="https://blog.wikichoon.com/2014/04/virt-convert-command-line-has-been.html"&gt;changed virt-convert&lt;/a&gt; to do vmx -&amp;gt; libvirt and ovf -&amp;gt;
libvirt which was a CLI breaking change, but I never heard a peep of a
complaint. It doesn't do a particularly thorough job at its
intended goal, I've seen 2-3 bug reports in the past 5 years and
generally it doesn't seem to have any users. Let's kill it. If anyone
has the desire to keep it alive it could live as a separate project
that's a wrapper around virt-install but there's no compelling reason to
keep it in virt-manager.git IMO&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;That mostly sums it up. If there's any users of virt-convert out there, you likely
can get similar results by extracting the relevant disk image from the
&lt;code&gt;.vmx&lt;/code&gt; or &lt;code&gt;.ovf&lt;/code&gt; config, pass it to &lt;code&gt;virt-manager&lt;/code&gt; or &lt;code&gt;virt-install&lt;/code&gt;, and let
those tools fill in the defaults. In truth that's about all &lt;code&gt;virt-convert&lt;/code&gt; did in
to begin with.&lt;/p&gt;</content><category term="fedora"></category><category term="virt"></category></entry><entry><title>python-bugzilla REST API support</title><link href="https://blog.wikichoon.com/2020/06/python-bugzilla-rest-api.html" rel="alternate"></link><published>2020-06-29T13:00:00-04:00</published><updated>2020-06-29T13:00:00-04:00</updated><author><name>Cole Robinson</name></author><id>tag:blog.wikichoon.com,2020-06-29:/2020/06/python-bugzilla-rest-api.html</id><summary type="html">&lt;p&gt;I just released &lt;strong&gt;&lt;a href="https://github.com/python-bugzilla/python-bugzilla"&gt;python-bugzilla&lt;/a&gt; 2.4.0&lt;/strong&gt;. The main interesting bit it adds is support for &lt;a href="https://wiki.mozilla.org/Bugzilla:REST_API"&gt;Bugzilla's REST API&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;All previous versions of python-bugzilla and &lt;code&gt;/usr/bin/bugzilla&lt;/code&gt; only used the XMLRPC API, but that is deprecated in Bugzilla 5.0+ and all new API development is taking place on …&lt;/p&gt;</summary><content type="html">&lt;p&gt;I just released &lt;strong&gt;&lt;a href="https://github.com/python-bugzilla/python-bugzilla"&gt;python-bugzilla&lt;/a&gt; 2.4.0&lt;/strong&gt;. The main interesting bit it adds is support for &lt;a href="https://wiki.mozilla.org/Bugzilla:REST_API"&gt;Bugzilla's REST API&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;All previous versions of python-bugzilla and &lt;code&gt;/usr/bin/bugzilla&lt;/code&gt; only used the XMLRPC API, but that is deprecated in Bugzilla 5.0+ and all new API development is taking place on the REST API.&lt;/p&gt;
&lt;p&gt;In practice there isn't any released bugzilla version that has big differences between the two API versions. On bugzilla.redhat.com specifically the XMLRPC API is still recommended, because some custom features are not available over REST yet. Note though that bugzilla.mozilla.org is looking at &lt;a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1599274"&gt;disabling the XMLRPC API entirely&lt;/a&gt;, but they are usually ahead of the Bugzilla curve.&lt;/p&gt;
&lt;p&gt;By default, python-bugzilla will use some URL parsing heuristics to try to guess if the
passed URL is for XMLRPC or REST.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;If URL contains &lt;code&gt;/xmlrpc&lt;/code&gt;, assume XMLRPC&lt;/li&gt;
&lt;li&gt;If URL contains &lt;code&gt;/rest&lt;/code&gt;, assume REST&lt;/li&gt;
&lt;li&gt;If the URL does not contain a path:&lt;ul&gt;
&lt;li&gt;Try appending &lt;code&gt;/xmlrpc.cgi&lt;/code&gt; and if the URL exists, use it&lt;/li&gt;
&lt;li&gt;Try appending &lt;code&gt;/rest&lt;/code&gt; and if the URL exists, use it&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Otherwise just attempt to initialize the XMLRPC backend&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;In practice this should mean previously used URLs will continue to use XMLRPC.&lt;/p&gt;
&lt;p&gt;The &lt;code&gt;Bugzilla&lt;/code&gt; API class also &lt;code&gt;force_rest&lt;/code&gt; and &lt;code&gt;force_xmlrpc&lt;/code&gt; init arguments to
force use of a specific API for the passed URL. Whether REST or XMLRPC is used
the existing API should continue to work as expected, it's simply a backend detail.&lt;/p&gt;
&lt;p&gt;From &lt;code&gt;/usr/bin/bugzilla&lt;/code&gt; there aren't any explicit command line options to force
use of one API or the other. If you pass a URL with an explicit &lt;code&gt;/rest&lt;/code&gt; or
&lt;code&gt;/xmlrpc.cgi&lt;/code&gt; then the API will pick the correct backend based on the heuristic
above. If your URL has a weirdly named REST API endpoint you can probably trick
the heuristic with a funky URL like &lt;code&gt;https://fakebz.example.com/weird-rest-endpoint?/rest&lt;/code&gt;&lt;/p&gt;</content><category term="fedora"></category></entry><entry><title>virt-manager is deprecated in RHEL (but only RHEL)</title><link href="https://blog.wikichoon.com/2020/06/virt-manager-deprecated-in-rhel.html" rel="alternate"></link><published>2020-06-16T13:00:00-04:00</published><updated>2020-06-16T13:00:00-04:00</updated><author><name>Cole Robinson</name></author><id>tag:blog.wikichoon.com,2020-06-16:/2020/06/virt-manager-deprecated-in-rhel.html</id><summary type="html">&lt;p&gt;&lt;strong&gt;TL;DR&lt;/strong&gt;: I'm the primary author of virt-manager. virt-manager is deprecated in RHEL8 in favor of cockpit, but ONLY in RHEL8 and future RHEL releases. The upstream project virt-manager is still maintained and is still relevant for other distros.&lt;/p&gt;
&lt;p&gt;Google 'virt-manager deprecated' and you'll find some discussions suggesting
virt-manager is …&lt;/p&gt;</summary><content type="html">&lt;p&gt;&lt;strong&gt;TL;DR&lt;/strong&gt;: I'm the primary author of virt-manager. virt-manager is deprecated in RHEL8 in favor of cockpit, but ONLY in RHEL8 and future RHEL releases. The upstream project virt-manager is still maintained and is still relevant for other distros.&lt;/p&gt;
&lt;p&gt;Google 'virt-manager deprecated' and you'll find some discussions suggesting
virt-manager is no longer maintained, &lt;a href="https://cockpit-project.org/"&gt;Cockpit&lt;/a&gt; is replacing virt-manager, virt-manager is going to be removed from every distro, etc. These conclusions are misinformed.&lt;/p&gt;
&lt;p&gt;The primary source for this confusion is the section 'virt-manager has been deprecated' from the &lt;a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/8.2_release_notes/deprecated_functionality#deprecated-functionality_virtualization"&gt;RHEL8 release notes virtualization deprecation section&lt;/a&gt;. Relevant quote from the RHEL8.2 docs:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The Virtual Machine Manager application, also known as virt-manager, has been deprecated.
The RHEL 8 web console, also known as Cockpit, is intended to become its replacement in a subsequent release.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;What that means:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;virt-manager is in RHEL8 and will be there for the lifetime of RHEL8.&lt;/li&gt;
&lt;li&gt;Red Hat engineering effort assigned to the virt-manager UI has been reduced compared to previous RHEL versions.&lt;/li&gt;
&lt;li&gt;The tentative plan is to not ship the virt-manager UI in RHEL9.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Why is this happening? As I understand it, RHEL wants to roughly standardize on Cockpit as their host admin UI tool. It's a great project with great engineers and great UI designers. Red Hat is going all in on it for RHEL and aims to replace the mismash of system-config-X tools and project specific admin frontends (like virt-manager) with a unified project. (Please note: this is my paraphrased understanding, I'm not speaking on behalf of Red Hat here.)&lt;/p&gt;
&lt;p&gt;Notice though, this is all about RHEL. virt-manager is not deprecated upstream, or deprecated in other distros automatically just because RHEL has made this decision. The upstream virt-manager project continues on and Red Hat continues to allocate resources to maintain it.&lt;/p&gt;
&lt;p&gt;Also, I'm distinguishing virt-manager UI from the virt-manager project, which includes tools like &lt;code&gt;virt-install&lt;/code&gt;. I fully expect &lt;code&gt;virt-install&lt;/code&gt; to be shipped in RHEL9 and actively maintained (FWIW Cockpit uses it behind the scenes).&lt;/p&gt;
&lt;p&gt;And even if the virt-manager UI is not in RHEL9 repos, it will likely end up shipped in EPEL, so the UI will still be available for install, just through external repos.&lt;/p&gt;
&lt;p&gt;Overall my personal opinion is that as long as libvirt+KVM is in use on linux desktops and servers, virt-manager will be relevant. I don't expect anything to change in that area any time soon.&lt;/p&gt;</content><category term="fedora"></category><category term="virt"></category></entry><entry><title>Blog moved to Pelican and GitHub Pages</title><link href="https://blog.wikichoon.com/2019/07/blog-moved.html" rel="alternate"></link><published>2019-07-30T15:30:00-04:00</published><updated>2019-07-30T15:30:00-04:00</updated><author><name>Cole Robinson</name></author><id>tag:blog.wikichoon.com,2019-07-30:/2019/07/blog-moved.html</id><summary type="html">&lt;p&gt;I've moved my blog from blogger.com to a static site generated with
&lt;a href="https://blog.getpelican.com/"&gt;Pelican&lt;/a&gt; and hosted on GitHub Pages. This
is a dump of some of the details.&lt;/p&gt;
&lt;p&gt;The content is hosted in three branches across two repos:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href="https://github.com/crobinso/blog/tree/gh-pages"&gt;blog/gh-pages&lt;/a&gt;&lt;/strong&gt;: &lt;a href="https://blog.wikichoon.com"&gt;https://blog.wikichoon.com&lt;/a&gt; HTML content&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href="https://github.com/crobinso/crobinso.github.io/tree/master"&gt;crobinso.github.io/master …&lt;/a&gt;&lt;/strong&gt;&lt;/li&gt;&lt;/ul&gt;</summary><content type="html">&lt;p&gt;I've moved my blog from blogger.com to a static site generated with
&lt;a href="https://blog.getpelican.com/"&gt;Pelican&lt;/a&gt; and hosted on GitHub Pages. This
is a dump of some of the details.&lt;/p&gt;
&lt;p&gt;The content is hosted in three branches across two repos:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href="https://github.com/crobinso/blog/tree/gh-pages"&gt;blog/gh-pages&lt;/a&gt;&lt;/strong&gt;: &lt;a href="https://blog.wikichoon.com"&gt;https://blog.wikichoon.com&lt;/a&gt; HTML content&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href="https://github.com/crobinso/crobinso.github.io/tree/master"&gt;crobinso.github.io/master&lt;/a&gt;&lt;/strong&gt;: &lt;a href="https://wikichoon.com"&gt;https://wikichoon.com&lt;/a&gt; front page HTML content&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href="https://github.com/crobinso/crobinso.github.io/tree/pelican"&gt;crobinso.github.io/pelican&lt;/a&gt;&lt;/strong&gt;: website source content and theme&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The motivation for the split is that according to this &lt;a href="https://blog.kmonsoor.com/pelican-how-to-make-seo-friendly/"&gt;pelican SEO&lt;/a&gt; article, &lt;strong&gt;master&lt;/strong&gt; branches of GitHub repos are indexed by google, so if you store HTML content in a &lt;strong&gt;master&lt;/strong&gt; branch your canonical blog might be battling your GitHub repo in the search results. And since you can only put content in the &lt;strong&gt;master&lt;/strong&gt; branch of a &lt;code&gt;$username.github.io&lt;/code&gt; repo, I added a separate blog.git repo. Maybe I could shove all the content into the &lt;strong&gt;blog/gh-pages&lt;/strong&gt; branch I think dealing with multiple subdomains prevents it. I've already spent too much timing playing with all this stuff though so that's for another day to figure out. Of course, suggestions welcome, blog comments are enabled with Disqus.&lt;/p&gt;
&lt;p&gt;One issue I hit is that pushing updated content to &lt;strong&gt;blog/gh-pages&lt;/strong&gt; doesn't consistently trigger a new GitHub Pages deployment. There's a bunch of hits about this around the web (this &lt;a href="https://stackoverflow.com/questions/20422279/github-pages-are-not-updating"&gt;stackoverflow post&lt;/a&gt; in particular) but no authoritative explanation about what criteria GitHub Pages uses to determine whether to redeploy. The simplest 'fix' I found is to tweak the &lt;code&gt;index.html&lt;/code&gt; content via the GitHub web UI and commit the change which seems to consistently trigger a refresh as reported by the repo's &lt;a href="https://github.com/crobinso/blog/deployments"&gt;deployments page&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;You may notice the blog looks a lot like stock &lt;a href="https://jekyllrb.com/"&gt;Jekyll&lt;/a&gt; with its &lt;a href="https://github.com/jekyll/minima"&gt;minima&lt;/a&gt; theme. I didn't find any Pelican theme that I liked as much as minima, so I grabbed the CSS from a minima instance and started adapting the Pelican &lt;a href="https://github.com/getpelican/pelican-themes/tree/master/simple-bootstrap"&gt;simple-bootstrap&lt;/a&gt; theme to use it. The end result is basically a simple reimplementation of minima for Pelican. I learned a lot in the process but it likely would have been much simpler if I just used Jekyll in the first place, but I'm in too deep to switch now!&lt;/p&gt;</content><category term="fedora"></category><category term="virt"></category></entry><entry><title>Host 'Network Interfaces' panel removed from virt-manager</title><link href="https://blog.wikichoon.com/2019/04/host-network-interfaces-panel-removed.html" rel="alternate"></link><published>2019-04-09T14:01:00-04:00</published><updated>2019-04-09T14:01:00-04:00</updated><author><name>Cole Robinson</name></author><id>tag:blog.wikichoon.com,2019-04-09:/2019/04/host-network-interfaces-panel-removed.html</id><summary type="html">&lt;p&gt;I released &lt;a href="https://www.redhat.com/archives/virt-tools-list/2018-October/msg00087.html"&gt;virt-manager 2.0.0&lt;/a&gt; in October 2018. Since the release contained the full port to python3, it seemed like a good opportunity to drop some baggage from the app.&lt;/p&gt;
&lt;p&gt;The biggest piece we removed was the UI for managing host network interfaces. This is the &lt;strong&gt;Connection Details-&amp;gt;Network …&lt;/strong&gt;&lt;/p&gt;</summary><content type="html">&lt;p&gt;I released &lt;a href="https://www.redhat.com/archives/virt-tools-list/2018-October/msg00087.html"&gt;virt-manager 2.0.0&lt;/a&gt; in October 2018. Since the release contained the full port to python3, it seemed like a good opportunity to drop some baggage from the app.&lt;/p&gt;
&lt;p&gt;The biggest piece we removed was the UI for managing host network interfaces. This is the &lt;strong&gt;Connection Details-&amp;gt;Network Interfaces&lt;/strong&gt; panel, and the &lt;strong&gt;New Interface&lt;/strong&gt; wizard for defining host network definitions for things like bridges, bonds, and vlan devices. The main screen of the old UI looked like this:&lt;/p&gt;
&lt;p&gt;&lt;img alt="virt-manager host interfaces panel" height="280" src="https://blog.wikichoon.com/images/074-host-network-interfaces-panel-removed-1.png" width="400"&gt;&lt;/p&gt;
&lt;h4&gt;Some history&lt;/h4&gt;
&lt;p&gt;Behind the scenes, this UI was using libvirt's Interface APIs, which also power the &lt;code&gt;virsh iface-*&lt;/code&gt; commands. These APIs are little more than a wrapper around the &lt;a href="https://pagure.io/netcf"&gt;netcf&lt;/a&gt; library.&lt;/p&gt;
&lt;p&gt;netcf aimed to be a linux distro independent API for network device configuration. On Red Hat distros this meant turning the API's XML format into an &lt;code&gt;/etc/sysconfig/network&lt;/code&gt; script. There were even pie-in-the-sky ideas about NetworkManager one day using netcf.&lt;/p&gt;
&lt;p&gt;In practice though the library never really took off. It was years before a debian backend showed up, contributed by a Red Hatter in the hope of increasing library uptake, though it didn't seem to help. netcf basically only existed to serve the libvirt Interface APIs, yet those APIs were never really used by any major libvirt consuming app, besides virt-manager. And in virt-manager's case it was largely just slapping some UI over the XML format and lifecycle operations.&lt;/p&gt;
&lt;p&gt;For virt-manager's usecases we hoped that netcf would make it trivial to bridge the host's network interface, which when used with VMs would give them first class IP addresses on the host network setup, not NAT like the 'default' virtual network. Unfortunately though the UI would create the ifcfg files well enough, behind the scenes nothing played well with NetworkManager for years and years. The standard suggestion for was to disable NetworkManager if you wanted to bridge your host NIC. Not very user friendly. Some people did manage to use the UI to that effect but it was never a trivial process.&lt;/p&gt;
&lt;h4&gt;The state today&lt;/h4&gt;
&lt;p&gt;Nowadays NetworkManager can handle bridging natively and is much more powerful than what virt-manager/libvirt/netcf provide. The virt-manager UI was more likely to shoot you in the foot than make things simple. And it had become increasingly clear that virt-manager was not the place to maintain host network config UI.&lt;/p&gt;
&lt;p&gt;So we made the decision to drop all this from virt-manager in 2.0.0. netcf and the libvirt interface APIs still exist. If you're interested in some more history on the interface API/netcf difficulties, check out &lt;a href="https://www.redhat.com/archives/virt-tools-list/2018-October/msg00049.html"&gt;Laine's email&lt;/a&gt; to virt-tools-list.&lt;/p&gt;</content><category term="fedora"></category><category term="virt"></category></entry><entry><title>python-bugzilla + bugzilla 5.0 API keys</title><link href="https://blog.wikichoon.com/2019/01/python-bugzilla-bugzilla-50-api-keys.html" rel="alternate"></link><published>2019-01-09T17:58:00-05:00</published><updated>2019-01-09T17:58:00-05:00</updated><author><name>Cole Robinson</name></author><id>tag:blog.wikichoon.com,2019-01-09:/2019/01/python-bugzilla-bugzilla-50-api-keys.html</id><summary type="html">&lt;p&gt;For many uses of &lt;code&gt;/usr/bin/bugzilla&lt;/code&gt; and python-bugzilla, it's necessary to actually be logged in to a bugzilla server. Creating bugs, editing bugs, querying private data, etc.&lt;/p&gt;
&lt;p&gt;Up until now anyone that's used the command line tool has periodically had to do a &lt;code&gt;bugzilla login&lt;/code&gt; to refresh their authentication …&lt;/p&gt;</summary><content type="html">&lt;p&gt;For many uses of &lt;code&gt;/usr/bin/bugzilla&lt;/code&gt; and python-bugzilla, it's necessary to actually be logged in to a bugzilla server. Creating bugs, editing bugs, querying private data, etc.&lt;/p&gt;
&lt;p&gt;Up until now anyone that's used the command line tool has periodically had to do a &lt;code&gt;bugzilla login&lt;/code&gt; to refresh their authentication cache. In older bugzilla versions this was an HTTP cookie, more recently it's a bugzilla API token. Generally &lt;code&gt;login&lt;/code&gt; calls were needed infrequently on a single machine as tokens would remain valid for a long time.&lt;/p&gt;
&lt;p&gt;Recently, bugzilla.redhat.com received a big update to bugzilla 5.0. However with that update it seems like API tokens now expire after a week, which has necessitated lots more &lt;code&gt;bugzilla login&lt;/code&gt; calls than I'm used to.&lt;/p&gt;
&lt;p&gt;Thankfully with &lt;strong&gt;bugzilla 5.0&lt;/strong&gt; and later there's a better option: API keys. Here's how to to use them transparently with &lt;code&gt;/usr/bin/bugzilla&lt;/code&gt; and all python-bugzilla library usage. Here's steps for enabling API keys with bugzilla.redhat.com, but the same process should roughly apply to other bugzilla instances too.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Login to the bugzilla web UI&lt;/li&gt;
&lt;li&gt;Click on your email&lt;/li&gt;
&lt;li&gt;Select &lt;strong&gt;Preferences&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;Select &lt;strong&gt;API Keys&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;Generate an API key with an optional comment like &lt;code&gt;python-bugzilla&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Afterwards the screen will look something like this (updated in June 2020):&lt;/p&gt;
&lt;p&gt;&lt;img alt="Bugzilla web UI API key setup" height="384" src="https://blog.wikichoon.com/images/073-python-bugzilla-bugzilla-50-api-keys-2.png" width="640"&gt;&lt;/p&gt;
&lt;p&gt;&lt;code&gt;MY-FAKE-KEY&lt;/code&gt; is not my actual key, I replaced it for demo purposes. The actual key is a long string of characters and numbers.&lt;/p&gt;
&lt;p&gt;On &lt;code&gt;bugzilla.redhat.com&lt;/code&gt; the key is only visible in the red box when the key is initially created; refreshing the page will only show the numeric &lt;code&gt;API key ID&lt;/code&gt; which is not what you want. So if you missed copying that value the first time, revoke the key and create a new one.&lt;/p&gt;
&lt;p&gt;Once you've copied your key, write a bugzillarc file like this:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="na"&gt;$ cat ~/.config/python-bugzilla/bugzillarc&lt;/span&gt;
&lt;span class="k"&gt;[bugzilla.redhat.com]&lt;/span&gt;
&lt;span class="na"&gt;api_key&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s"&gt;MY-FAKE-KEY&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;That's it, &lt;code&gt;/usr/bin/bugzilla&lt;/code&gt; and python-bugzilla using tools should pick it up automagically. Note, API keys are as good as passwords in certain ways, so treat it with the same secrecy you would treat a password.&lt;/p&gt;</content><category term="fedora"></category></entry><entry><title>Setting custom network names on Fedora</title><link href="https://blog.wikichoon.com/2018/10/setting-custom-network-names-on-fedora.html" rel="alternate"></link><published>2018-10-04T21:27:00-04:00</published><updated>2018-10-04T21:27:00-04:00</updated><author><name>Cole Robinson</name></author><id>tag:blog.wikichoon.com,2018-10-04:/2018/10/setting-custom-network-names-on-fedora.html</id><summary type="html">&lt;p&gt;&lt;a href="https://www.freedesktop.org/wiki/Software/systemd/PredictableNetworkInterfaceNames/"&gt;systemd predictable network names&lt;/a&gt; give us host interface names like &lt;strong&gt;enp3s0&lt;/strong&gt;. On one of my hosts, I have two interfaces: one that is my regular hard wired connection, and another I only plug in occasionally for some virt network testing. I can never remember the systemd names, so I want …&lt;/p&gt;</summary><content type="html">&lt;p&gt;&lt;a href="https://www.freedesktop.org/wiki/Software/systemd/PredictableNetworkInterfaceNames/"&gt;systemd predictable network names&lt;/a&gt; give us host interface names like &lt;strong&gt;enp3s0&lt;/strong&gt;. On one of my hosts, I have two interfaces: one that is my regular hard wired connection, and another I only plug in occasionally for some virt network testing. I can never remember the systemd names, so I want to rename the interfaces to something more descriptive for my needs. in my case &lt;strong&gt;lan0main&lt;/strong&gt; and &lt;strong&gt;lan1pcie&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;The page referenced says to use systemd links. However after struggling with that for a while I'm that's only relevant to systemd-networkd usage and doesn't apply to Fedora's default use of NetworkManager. So I needed another way.&lt;/p&gt;
&lt;p&gt;Long story short I ended up with some custom udev rules that are patterned after the old 70-persistent-net.rules file. Replace &lt;code&gt;$MYMAC1&lt;/code&gt; and &lt;code&gt;$MYMAC2&lt;/code&gt; with your specific values&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;$&lt;/span&gt; cat /etc/udev/rules.d/99-cole-nic-names.rules
&lt;span class="go"&gt;SUBSYSTEM==&amp;quot;net&amp;quot;, ACTION==&amp;quot;add&amp;quot;, DRIVERS==&amp;quot;?*&amp;quot;, ATTR{address}==&amp;quot;$MYMAC1&amp;quot;, ATTR{type}==&amp;quot;1&amp;quot;, NAME=&amp;quot;lan0main&amp;quot;&lt;/span&gt;
&lt;span class="go"&gt;SUBSYSTEM==&amp;quot;net&amp;quot;, ACTION==&amp;quot;add&amp;quot;, DRIVERS==&amp;quot;?*&amp;quot;, ATTR{address}==&amp;quot;$MYMAC2&amp;quot;, ATTR{type}==&amp;quot;1&amp;quot;, NAME=&amp;quot;lan1pcie&amp;quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content><category term="fedora"></category><category term="virt"></category></entry><entry><title>Configuring offlineimap + dovecot + thunderbird</title><link href="https://blog.wikichoon.com/2017/05/configuring-offlineimap-dovecot.html" rel="alternate"></link><published>2017-05-18T08:01:00-04:00</published><updated>2017-05-18T08:01:00-04:00</updated><author><name>Cole Robinson</name></author><id>tag:blog.wikichoon.com,2017-05-18:/2017/05/configuring-offlineimap-dovecot.html</id><summary type="html">&lt;p&gt;Recently some internal discussions at Red Hat motivated me to look into using &lt;a href="https://github.com/OfflineIMAP/offlineimap"&gt;offlineimap&lt;/a&gt;. I had thought about doing this for some time as a step towards giving &lt;a href="https://www.mutt.org/"&gt;mutt&lt;/a&gt; a try, but for now I decided to keep my original thunderbird setup. This turned out to be a bit more …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Recently some internal discussions at Red Hat motivated me to look into using &lt;a href="https://github.com/OfflineIMAP/offlineimap"&gt;offlineimap&lt;/a&gt;. I had thought about doing this for some time as a step towards giving &lt;a href="https://www.mutt.org/"&gt;mutt&lt;/a&gt; a try, but for now I decided to keep my original thunderbird setup. This turned out to be a bit more work than I anticipated, so I'm documenting it here.&lt;/p&gt;
&lt;p&gt;The primary difficulty is that offlineimap stores mail locally in Maildir format, but thunderbird only reads mbox format. The common solution to this is to serve the offlineimap mail via a local mail server, and have thunderbird connect to that. For the mail server I'm using &lt;a href="https://www.dovecot.org/"&gt;dovecot&lt;/a&gt;. Getting offlineimap output and dovecot to play nicely together in a format that thunderbird can consume was a bit tricky...&lt;/p&gt;
&lt;p&gt;Here's the ~/.offlineimaprc I settled on:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="k"&gt;[general]&lt;/span&gt;
&lt;span class="na"&gt;accounts&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;work &lt;/span&gt;

&lt;span class="k"&gt;[Account work]&lt;/span&gt;
&lt;span class="na"&gt;localrepository&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;local-work&lt;/span&gt;
&lt;span class="na"&gt;remoterepository&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;remote-work&lt;/span&gt;

&lt;span class="c1"&gt;# Do a full check every 2 minutes&lt;/span&gt;
&lt;span class="c1"&gt;# autorefresh = 2&lt;/span&gt;
&lt;span class="c1"&gt;# Do 5 quick checks between every full check&lt;/span&gt;
&lt;span class="c1"&gt;# quick = 5&lt;/span&gt;


&lt;span class="k"&gt;[Repository local-work]&lt;/span&gt;
&lt;span class="na"&gt;type&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;Maildir&lt;/span&gt;
&lt;span class="na"&gt;localfolders&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;~/.maildir&lt;/span&gt;

&lt;span class="c1"&gt;# Translate your maildir folder names to the format the remote server expects&lt;/span&gt;
&lt;span class="c1"&gt;# So this reverses the change we make with the remote nametrans setting&lt;/span&gt;
&lt;span class="na"&gt;nametrans&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;lambda name: re.sub(&amp;#39;^\.&amp;#39;, &amp;#39;&amp;#39;, name)&lt;/span&gt;


&lt;span class="k"&gt;[Repository remote-work]&lt;/span&gt;
&lt;span class="na"&gt;type&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;IMAP&lt;/span&gt;
&lt;span class="na"&gt;keepalive&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;300&lt;/span&gt;
&lt;span class="na"&gt;ssl&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;yes&lt;/span&gt;
&lt;span class="na"&gt;sslcacertfile&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;/etc/ssl/certs/ca-bundle.crt&lt;/span&gt;
&lt;span class="na"&gt;remotehost&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;$YOUR-WORK-MAIL-SERVER&lt;/span&gt;
&lt;span class="na"&gt;remoteuser&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;$YOUR-USERNAME&lt;/span&gt;
&lt;span class="c1"&gt;# You can specify remotepass= , but my work setup implicitly uses kerberos&lt;/span&gt;

&lt;span class="c1"&gt;# Turn this on if you are manually messing with your maildir at all&lt;/span&gt;
&lt;span class="c1"&gt;# I lost some mail in my experiments :(&lt;/span&gt;
&lt;span class="c1"&gt;#readonly = yes&lt;/span&gt;

&lt;span class="c1"&gt;# Need to exclude &amp;#39;&amp;#39; otherwise it complains about infinite naming loop?&lt;/span&gt;
&lt;span class="na"&gt;folderfilter&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;lambda foldername: foldername not in [&amp;#39;&amp;#39;]&lt;/span&gt;
&lt;span class="c1"&gt;# For Dovecot to see the folders right I want them starting with a dot,&lt;/span&gt;
&lt;span class="c1"&gt;# and dovecot set to look for .INBOX as the toplevel Maildir&lt;/span&gt;
&lt;span class="na"&gt;nametrans&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;lambda name: &amp;#39;.&amp;#39; + name&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;A few notes here:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;autorefresh/quick are commented out because I'm not using them: I'm invoking 'offlineimap -o' with cron ever 2 minutes, with a small wrapper that ensures offlineimap isn't already running (not sure if that will have nasty side effects), and also checks that I'm on my work VPN (checking for a /sys/net/class/ path). I went with this setup because running offlineimap persistently will exit if it can't resolve the remote server after a few attempts, which will trigger if I leave the VPN. Maybe there's a setting to keep it running persistently but I couldn't find it.&lt;/li&gt;
&lt;li&gt;Enable the 'readonly' option and 'offlineimap --dry-run' when initially configuring things or messing with maildir layout: I lost a few hours of mail somehow during the setup process :/&lt;/li&gt;
&lt;li&gt;My setup implicitly depends on having authenticated with my companies kerberos. Still haven't figured out a good way of keeping the kerberos ticket fresh on a machine that moves on and off the VPN regularly. I know &lt;a href="https://jhrozek.wordpress.com/2015/07/17/get-rid-of-calling-manually-calling-kinit-with-sssds-help/"&gt;SSSD can kinda handle&lt;/a&gt; it but it seems to tie local login to work infrastructure which I'm not sure I want.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;For dovecot, I just needed to drop this into /etc/dovecot/local.conf and start/enable the service:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="na"&gt;protocols&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;imap imaps&lt;/span&gt;
&lt;span class="na"&gt;listen&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;127.0.0.1&lt;/span&gt;
&lt;span class="na"&gt;mail_location&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s"&gt;maildir:~/.maildir:INBOX=~/.maildir/.INBOX&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;Then configure thunderbird to connect to 127.0.0.1. User and password are the same as your local machine user account.&lt;/p&gt;
&lt;p&gt;The tricky part seems to be formatting the maildir directory names in a way that dovecot will understand and properly advertise as folders/subfolders. I played with dovecot LAYOUT=fs, various sep/separator values and offlineimap renamings, but the above config is the only thing I found that gave expected results (and I can't take credit for that setup, I eventually found it on an internal wiki page :) )&lt;/p&gt;
&lt;p&gt;Here's some (trimmed) directories in my ~/.maildir:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="gp"&gt;$&lt;/span&gt; ls -1da .maildir/
&lt;span class="go"&gt;.Drafts&lt;/span&gt;
&lt;span class="go"&gt;.INBOX&lt;/span&gt;
&lt;span class="go"&gt;.INBOX.fedora&lt;/span&gt;
&lt;span class="go"&gt;.INBOX.libvirt&lt;/span&gt;
&lt;span class="go"&gt;.INBOX.qemu&lt;/span&gt;
&lt;span class="go"&gt;.INBOX.virt-tools&lt;/span&gt;
&lt;span class="go"&gt;.Junk&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


&lt;p&gt;So .Drafts, .INBOX, .Junk are all top level folders, and things like .INBOX.fedora is a 'fedora' subfolder of my inbox. That's the naming scheme the default dovecot config seems to expect.&lt;/p&gt;</content><category term="fedora"></category></entry><entry><title>Easy qemu commandline passthrough with virt-xml</title><link href="https://blog.wikichoon.com/2017/03/easy-qemu-commandline-passthrough-with.html" rel="alternate"></link><published>2017-03-24T21:30:00-04:00</published><updated>2017-03-24T21:30:00-04:00</updated><author><name>Cole Robinson</name></author><id>tag:blog.wikichoon.com,2017-03-24:/2017/03/easy-qemu-commandline-passthrough-with.html</id><summary type="html">&lt;p&gt;Libvirt has supported &lt;a href="https://libvirt.org/drvqemu.html#qemucommand"&gt;qemu commandline option passthrough&lt;/a&gt; for qemu/kvm VMs for quite a while. The format for it is a bit of a pain though since it requires setting a magic xmlns value at the top of the domain XML. Basically doing it by hand kinda sucks.&lt;/p&gt;
&lt;p&gt;In the …&lt;/p&gt;</summary><content type="html">&lt;p&gt;Libvirt has supported &lt;a href="https://libvirt.org/drvqemu.html#qemucommand"&gt;qemu commandline option passthrough&lt;/a&gt; for qemu/kvm VMs for quite a while. The format for it is a bit of a pain though since it requires setting a magic xmlns value at the top of the domain XML. Basically doing it by hand kinda sucks.&lt;/p&gt;
&lt;p&gt;In the recently released &lt;a href="https://blog.wikichoon.com/2017/03/virt-manager-141-released.html"&gt;virt-manager 1.4.1&lt;/a&gt;, we added a virt-install/virt-xml option &lt;code&gt;--qemu-commandline&lt;/code&gt; that tweaks option passthrough for new or existing VMs. So for example, if you wanted to add the qemu option string &lt;code&gt;-device FOO&lt;/code&gt; to an existing VM named &lt;strong&gt;f25&lt;/strong&gt;, you can do:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;$ ./virt-xml f25 --edit --confirm --qemu-commandline=&amp;quot;-device FOO&amp;quot;

&lt;span class="gd"&gt;--- Original XML&lt;/span&gt;
&lt;span class="gi"&gt;+++ Altered XML&lt;/span&gt;
&lt;span class="gu"&gt;@@ -1,4 +1,4 @@&lt;/span&gt;
&lt;span class="gd"&gt;-&amp;lt;domain type=&amp;quot;kvm&amp;quot;&amp;gt;&lt;/span&gt;
&lt;span class="gi"&gt;+&amp;lt;domain xmlns:qemu=&amp;quot;https://libvirt.org/schemas/domain/qemu/1.0&amp;quot; type=&amp;quot;kvm&amp;quot;&amp;gt;&lt;/span&gt;
   &amp;lt;name&amp;gt;f25&amp;lt;/name&amp;gt;
   &amp;lt;uuid&amp;gt;9b6f1795-c88b-452a-a54c-f8579ddc18dd&amp;lt;/uuid&amp;gt;
   &amp;lt;memory unit=&amp;quot;KiB&amp;quot;&amp;gt;4194304&amp;lt;/memory&amp;gt;
&lt;span class="gu"&gt;@@ -104,4 +104,8 @@&lt;/span&gt;
       &amp;lt;address type=&amp;quot;pci&amp;quot; domain=&amp;quot;0x0000&amp;quot; bus=&amp;quot;0x00&amp;quot; slot=&amp;quot;0x0a&amp;quot; function=&amp;quot;0x0&amp;quot;/&amp;gt;
     &amp;lt;/rng&amp;gt;
   &amp;lt;/devices&amp;gt;
&lt;span class="gi"&gt;+  &amp;lt;qemu:commandline&amp;gt;&lt;/span&gt;
&lt;span class="gi"&gt;+    &amp;lt;qemu:arg value=&amp;quot;-device&amp;quot;/&amp;gt;&lt;/span&gt;
&lt;span class="gi"&gt;+    &amp;lt;qemu:arg value=&amp;quot;foo&amp;quot;/&amp;gt;&lt;/span&gt;
&lt;span class="gi"&gt;+  &amp;lt;/qemu:commandline&amp;gt;&lt;/span&gt;
 &amp;lt;/domain&amp;gt;

Define &amp;#39;f25&amp;#39; with the changed XML? (y/n):
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content><category term="fedora"></category><category term="virt"></category></entry></feed>