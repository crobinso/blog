<!DOCTYPE html>
<!-- Generated 2020-06-29 19:00:54.296000 -->
<html lang="en">
  <head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-142995745-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-142995745-1');
    </script>
    <link rel="canonical" href="https://blog.wikichoon.com/2014/05/a-brief-ish-history-of-virtinst-and.html"/>
      <title>A brief-ish history of virtinst and virt-install | Cole Robinson</title>
      <meta charset="utf-8" />
      <link href="https://blog.wikichoon.com/theme/minima-main.css" rel="stylesheet" />
      <link href="https://blog.wikichoon.com/theme/coletheme.css" rel="stylesheet" />
      <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
        <link href="https://blog.wikichoon.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Cole Robinson Full Atom Feed" />
  </head>

  <body id="index" class="archive">
    <header class="site-header">
      <div class="wrapper">
        <a class="site-title" href="https://blog.wikichoon.com">Cole Robinson</a>
        <nav class="site-nav">
          <input type="checkbox" id="nav-trigger" class="nav-trigger" />
          <label for="nav-trigger">
            <span class="menu-icon">
              <svg viewBox="0 0 18 15" width="18px" height="15px">
                <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
              </svg>
            </span>
          </label>
          <div class="trigger">
            <a class="page-link" href="https://blog.wikichoon.com">Home</a>
            <a class="page-link" href="https://blog.wikichoon.com/archives.html">Archives</a>
            <a class="page-link" href="https://wikichoon.com">About</a>
          </div>
        </nav>
      </div>
    </header>

    <main id="content" class="page-content">
      <div class="wrapper">
      <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
        <header>
          <h1 class="post-title givemecolor" itemprop="name headline">A brief-ish history of virtinst and virt-install</h2>
          <p class="post-meta">
            <time class="dt-published" datetime="2014-05-06T10:00:00-04:00" itemprop="datePublished">Tue 06 May 2014
            </time> • <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span class="p-author h-card" itemprop="name">Cole Robinson</span>
            </span> • Tags: <a href="https://blog.wikichoon.com/tag/fedora.html">fedora</a> <a href="https://blog.wikichoon.com/tag/virt.html">virt</a>           </p>
        </header>

        <div class="post-content" itemprop="articleBody">
          <p><a href="https://linux.die.net/man/1/virt-install">virt-install</a> is a command line tool for creating new virtual machines via libvirt. It's an important piece of the libvirt ecosystem that has shipped in RHEL5.0 and up, and over a dozen Fedora versions.</p>
<p>It wasn't always called virt-install though: it started life as xenguest-install.py written by <a href="https://velohacker.com/">Jeremy Katz</a>. I think it was just an internal Red Hat only thing for a brief period, until it first surfaced as part of the Fedora 'xen' package in <a href="https://pkgs.fedoraproject.org/cgit/xen.git/commit/?id=02687b4e3f7fa0db5de34280a2cb7e1a8eb8ff18">January 2006</a>:</p>
<div class="highlight"><pre><span></span><code><span class="k">commit</span><span class="w"> </span><span class="mi">02687</span><span class="n">b4e3f7fa0db5de34280a2cb7e1a8eb8ff18</span><span class="w"></span>
<span class="nl">Author</span><span class="p">:</span><span class="w"> </span><span class="n">Stephen</span><span class="w"> </span><span class="n">Tweedie</span><span class="w"> </span><span class="o">&lt;</span><span class="n">sct</span><span class="nv">@fedoraproject</span><span class="p">.</span><span class="n">org</span><span class="o">&gt;</span><span class="w"></span>
<span class="nc">Date</span><span class="err">:</span><span class="w">  </span><span class="n">Tue</span><span class="w"> </span><span class="n">Jan</span><span class="w"> </span><span class="mi">31</span><span class="w"> </span><span class="mi">16</span><span class="err">:</span><span class="mi">59</span><span class="err">:</span><span class="mi">19</span><span class="w"> </span><span class="mi">2006</span><span class="w"> </span><span class="o">+</span><span class="mi">0000</span><span class="w"></span>

<span class="w">  </span><span class="k">Add</span><span class="w"> </span><span class="n">xenguest</span><span class="o">-</span><span class="n">install</span><span class="p">.</span><span class="n">py</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">sbin</span><span class="w"></span>
</code></pre></div>


<p>(Strangely, the file isn't actually in git... I assume this is some accident of the CVS->git conversion. You can see the version shipped with Fedora Core 5 in the <a href="https://archives.fedoraproject.org/pub/archive/fedora/linux/core/5/x86_64/os/Fedora/RPMS/xen-3.0.1-4.x86_64.rpm">archived RPM</a>).</p>
<p>Check out the original set of arguments</p>
<div class="highlight"><pre><span></span><code><span class="nv">Options</span>:
 <span class="o">-</span><span class="nv">h</span>, <span class="o">--</span><span class="nv">help</span>      <span class="k">show</span> <span class="nv">this</span> <span class="nv">help</span> <span class="nv">message</span> <span class="nv">and</span> <span class="k">exit</span>
 <span class="o">-</span><span class="nv">n</span> <span class="nv">NAME</span>, <span class="o">--</span><span class="nv">name</span><span class="o">=</span><span class="nv">NAME</span> <span class="nv">Name</span> <span class="nv">of</span> <span class="nv">the</span> <span class="nv">guest</span> <span class="nv">instance</span>
 <span class="o">-</span><span class="nv">f</span> <span class="nv">DISKFILE</span>, <span class="o">--</span><span class="nv">file</span><span class="o">=</span><span class="nv">DISKFILE</span>
            <span class="nv">File</span> <span class="nv">to</span> <span class="nv">use</span> <span class="nv">as</span> <span class="nv">the</span> <span class="nv">disk</span> <span class="nv">image</span>
 <span class="o">-</span><span class="nv">s</span> <span class="nv">DISKSIZE</span>, <span class="o">--</span><span class="nv">file</span><span class="o">-</span><span class="nv">size</span><span class="o">=</span><span class="nv">DISKSIZE</span>
            <span class="nv">Size</span> <span class="nv">of</span> <span class="nv">the</span> <span class="nv">disk</span> <span class="nv">image</span> <span class="ss">(</span><span class="k">if</span> <span class="nv">it</span> <span class="nv">doesn</span><span class="s1">&#39;</span><span class="s">t exist) in</span>
            <span class="nv">gigabytes</span>
 <span class="o">-</span><span class="nv">r</span> <span class="nv">MEMORY</span>, <span class="o">--</span><span class="nv">ram</span><span class="o">=</span><span class="nv">MEMORY</span>
            <span class="nv">Memory</span> <span class="nv">to</span> <span class="nv">allocate</span> <span class="k">for</span> <span class="nv">guest</span> <span class="nv">instance</span> <span class="nv">in</span> <span class="nv">megabytes</span>
 <span class="o">-</span><span class="nv">m</span> <span class="nv">MAC</span>, <span class="o">--</span><span class="nv">mac</span><span class="o">=</span><span class="nv">MAC</span>   <span class="nv">Fixed</span> <span class="nv">MAC</span> <span class="nv">address</span> <span class="k">for</span> <span class="nv">the</span> <span class="nv">guest</span><span class="c1">; if none is given a</span>
            <span class="k">random</span> <span class="nv">address</span> <span class="nv">will</span> <span class="nv">be</span> <span class="nv">used</span>
 <span class="o">-</span><span class="nv">v</span>, <span class="o">--</span><span class="nv">hvm</span>       <span class="nv">This</span> <span class="nv">guest</span> <span class="nv">should</span> <span class="nv">be</span> <span class="nv">a</span> <span class="nv">fully</span> <span class="nv">virtualized</span> <span class="nv">guest</span>
 <span class="o">-</span><span class="nv">c</span> <span class="nv">CDROM</span>, <span class="o">--</span><span class="nv">cdrom</span><span class="o">=</span><span class="nv">CDROM</span>
            <span class="nv">File</span> <span class="nv">to</span> <span class="nv">use</span> <span class="nv">a</span> <span class="nv">virtual</span> <span class="nv">CD</span><span class="o">-</span><span class="nv">ROM</span> <span class="nv">device</span> <span class="k">for</span> <span class="nv">fully</span>
            <span class="nv">virtualized</span> <span class="nv">guests</span>
 <span class="o">-</span><span class="nv">p</span>, <span class="o">--</span><span class="nv">paravirt</span>    <span class="nv">This</span> <span class="nv">guest</span> <span class="nv">should</span> <span class="nv">be</span> <span class="nv">a</span> <span class="nv">paravirtualized</span> <span class="nv">guest</span>
 <span class="o">-</span><span class="nv">l</span> <span class="nv">LOCATION</span>, <span class="o">--</span><span class="nv">location</span><span class="o">=</span><span class="nv">LOCATION</span>
            <span class="nv">Installation</span> <span class="nv">source</span> <span class="k">for</span> <span class="nv">paravirtualized</span> <span class="nv">guest</span> <span class="ss">(</span><span class="nv">eg</span>,
            <span class="nv">nfs</span>:<span class="nv">host</span>:<span class="o">/</span><span class="nv">path</span>, <span class="nv">https</span>:<span class="o">//</span><span class="nv">host</span><span class="o">/</span><span class="nv">path</span>, <span class="nv">ftp</span>:<span class="o">//</span><span class="nv">host</span><span class="o">/</span><span class="nv">path</span><span class="ss">)</span>
 <span class="o">-</span><span class="nv">x</span> <span class="nv">EXTRA</span>, <span class="o">--</span><span class="nv">extra</span><span class="o">-</span><span class="nv">args</span><span class="o">=</span><span class="nv">EXTRA</span>
            <span class="nv">Additional</span> <span class="nv">arguments</span> <span class="nv">to</span> <span class="nv">pass</span> <span class="nv">to</span> <span class="nv">the</span> <span class="nv">installer</span> <span class="nv">with</span>
            <span class="nv">paravirt</span> <span class="nv">guests</span>
</code></pre></div>


<p>All those bits are still working with virt-install today, although many are are deprecated and hidden from the --help output by default.</p>
<p>In early 2006, libvirt barely even existed, so the xenguest-install.py was generating <a href="https://wiki.xen.org/wiki/Xen_Configuration_File_Options">xen xm</a> config files (basically just raw python code) in /etc/xen.
Fedora CVS was the canonical home of the script.</p>
<p>In March 2006, <a href="https://berrange.com/">Dan Berrangé</a> <a href="https://git.fedorahosted.org/cgit/virt-manager.git/commit/?id=3ed0ef3">started work on virt-manager</a>. It was very briefly called gnome-vm-manager, then settled into gnome-virt-manager until July 2006 when it was <a href="https://git.fedorahosted.org/cgit/virt-manager.git/commit/?id=dc0d6db84cfe78c4a479381ead55bbd83c0cca55">renamed to virt-manager</a>.</p>
<p>In August 2006, xenguest-install moved to its own repo, <a href="https://git.fedorahosted.org/cgit/python-virtinst.git/commit/?id=1e2e1aa0ca0b5ed8669be61aa4271a3e8c1d7333">python-xeninst</a>:</p>
<div class="highlight"><pre><span></span><code><span class="nv">commit</span> <span class="mi">1</span><span class="nv">e2e1aa0ca0b5ed8669be61aa4271a3e8c1d7333</span>
<span class="nv">Author</span>: <span class="nv">Jeremy</span> <span class="nv">Katz</span> <span class="o">&lt;</span><span class="nv">katzj</span>@<span class="nv">redhat</span>.<span class="nv">com</span><span class="o">&gt;</span>
<span class="nv">Date</span>:  <span class="nv">Tue</span> <span class="nv">Aug</span> <span class="mi">8</span> <span class="mi">21</span>:<span class="mi">37</span>:<span class="mi">49</span> <span class="mi">2006</span> <span class="o">-</span><span class="mi">0400</span>

  <span class="nv">first</span> <span class="nv">pass</span> <span class="nv">at</span> <span class="nv">breaking</span> <span class="nv">up</span> <span class="nv">xenguest</span><span class="o">-</span><span class="nv">install</span> <span class="nv">to</span> <span class="nv">have</span> <span class="nv">more</span> <span class="nv">of</span> <span class="nv">a</span> <span class="nv">usable</span> <span class="nv">API</span>.
  <span class="nv">currently</span> <span class="nv">only</span> <span class="nv">works</span> <span class="k">for</span> <span class="nv">paravirt</span> <span class="nv">and</span> <span class="nv">some</span> <span class="nv">of</span> <span class="nv">the</span> <span class="nv">bits</span> <span class="nv">after</span> <span class="nv">the</span> <span class="nv">install</span>
  <span class="nv">gets</span> <span class="nv">started</span> <span class="nv">are</span> <span class="nv">still</span> <span class="nv">a</span> <span class="nv">little</span> <span class="nv">less</span> <span class="nv">than</span> <span class="nv">ideal</span>
</code></pre></div>


<p>Much of logic was moved to a 'xeninst' module. There were some initial bits for generating libvirt XML, but the primary usage was still generating native xen configuration.</p>
<p>(Both repositories were hosted in mercurial at hg.et.redhat.com for many years. We eventually <a href="https://www.redhat.com/archives/virt-tools-list/2011-March/msg00056.html">transitioned to git in March 2011</a>. Actually it's amazing it was only 3 years ago: I've pretty much entirely forgotten how to use mercurial despite using it for 4 years prior.)</p>
<p>In October 2006, the project was <a href="https://git.fedorahosted.org/cgit/python-virtinst.git/commit/?id=761ccd8a65a79737431aa1415d16b19ef9d8f9c8">renamed python-virtinst</a> and the tool renamed to virt-install. By this point virt-manager was using the xeninst module for guest creation and needed to <a href="https://git.fedorahosted.org/cgit/virt-manager.git/commit/?id=cd946bcfae2960c4769c5f12e235d1026a33328d">handle the rename</a> as well.</p>
<p>So now python-virtinst was its own standalone package, providing virt-install and a python library named virtinst. Over the next couple years the repo accumulated a few more tools: <a href="https://git.fedorahosted.org/cgit/python-virtinst.git/commit/?id=bfa6c18f94fdb9d30c30df494e4b338745e79f5e">virt-clone in May 2007</a>, <a href="https://git.fedorahosted.org/cgit/python-virtinst.git/commit/?id=c4d45ff7960bd84050bb382d597dc3cfdf3d3882">virt-image in June 2007</a>, and <a href="https://git.fedorahosted.org/cgit/python-virtinst.git/commit/?id=a0401fe359af0220ea3e609861042ad9f000d7d5">virt-convert (originally virt-unpack) in July 2008</a>.</p>
<p>However over the next few years we had some growing pains with the virtinst module. It wasn't exactly a planned API, rather a collection of code that grew organically from a quick hack of a script. It never received too much thought for future compatibility. The fact that it ended up as a public API was more historic accident than anything. Once we accumulated external users (<a href="https://github.com/cobbler/cobbler/commit/dd569b1834e9611b8390d334e2016b0659253e72">cobbler in March 2007</a> and <a href="https://git.fedorahosted.org/cgit/koji/commit/?id=64cc01be898547d150f0200111ff0e57176ecdd7">koji in July 2010</a>) we were stuck with the API in the name of back compatibility.</p>
<p>Then there was the general frustration of doing virt-manager development when it evolved in lockstep with virtinst: running upstream virt-manager always required running up to date python-virtinst, which was a barrier to upstream contribution.</p>
<p>So in February 2012 I layed out some reasons for <a href="https://www.redhat.com/archives/virt-tools-list/2012-February/msg00040.html">dropping virtinst as a public API and merging the code into virt-manager.git</a>, though it didn't fully happen until <a href="https://www.redhat.com/archives/virt-tools-list/2013-April/msg00026.html">april 2013 during the virt-manager 0.10.0 cycle</a>. In the intervening year, I sent patches to koan and koji to move off virtinst to calling the needed virt-* tool directly.</p>
<p>So nowadays virtinst, virt-install, etc. all live with virt-manager.git. If you're looking for a library that helps handle libvirt XML or create libvirt VMs, check out <a href="https://libvirt.org/git/?p=libvirt-designer.git;a=summary">libvirt-designer</a> and <a href="https://libvirt.org/git/?p=libvirt-glib.git;a=summary">libvirt-gobject/libvirt-gconfig</a>.</p>
        </div>

        <div id="disqus_thread"></div>
        <script>
          var disqus_config = function () {
            this.page.url = 'https://blog.wikichoon.com/2014/05/a-brief-ish-history-of-virtinst-and.html';
            this.page.identifier = 'https://blog.wikichoon.com/2014/05/a-brief-ish-history-of-virtinst-and.html';
          };

          (function() {
            var d = document, s = d.createElement('script');
            s.src = 'https://wikichoon-com.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
          })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

      </article>
      </div>
    </main>

    <footer class="site-footer h-card">
      <div class="wrapper">
        <h2 class="footer-heading">Cole's dev log</h2>
        <div class="footer-col-wrapper">
          <div class="footer-col footer-col-1">
            <ul class="contact-list">
                <li class="p-name">Cole Robinson </li><li><a class="u-email" href="mailto:">aintdiscole@gmail.com</a></li>
            </ul>
          </div>

          <div class="footer-col footer-col-2">
            <ul class="social-media-list">
              <li><a href="https://github.com/crobinso"><svg class="svg-icon"><use xlink:href="https://blog.wikichoon.com/theme/minima-social-icons.svg#github"></use></svg> <span class="username">crobinso</span></a></li>
              <li><a href="https://www.twitter.com/aintdiscole"><svg class="svg-icon"><use xlink:href="https://blog.wikichoon.com/theme/minima-social-icons.svg#twitter"></use></svg> <span class="username">aintdiscole</span></a></li>
              <li><a href="https://www.linkedin.com/in/cole-robinson-484a9912"><svg class="svg-icon"><use href="https://blog.wikichoon.com/theme/minima-social-icons.svg#linkedin"></use></svg> <span class="username">Cole Robinson</span></a></li>
            </ul>
          </div>

          <div class="footer-col footer-col-3">
            <a href="https://blog.wikichoon.com/feeds/all.atom.xml">RSS</a>
          </div>
        </div>
      </div>
    </footer>
  </body>
</html>